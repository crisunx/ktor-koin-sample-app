# ktor-koin-sample-app
> Ktor is a web application framework written in Kotlin that utilizes Coroutines to provide the fully asynchronous, non-blocking behavior.
 Shows usage of  ktor to create a simple API to store simple todo list.

[![ktlint](https://img.shields.io/badge/code%20style-%E2%9D%A4-FF4081.svg)](https://ktlint.github.io/)
![Kotlin](https://img.shields.io/badge/kotlin-v1.3.72-blue?style=flat&logo=data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA2MCA2MCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNjAgNjA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPGc+CgoJCTxsaW5lYXJHcmFkaWVudCBpZD0iWE1MSURfM18iIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iMTUuOTU5NCIgeTE9Ii0xMy4wMTQzIiB4Mj0iNDQuMzA2OCIgeTI9IjE1LjMzMzIiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoMSAwIDAgLTEgMCA2MSkiPgoJCTxzdG9wICBvZmZzZXQ9IjkuNjc3MDAwZS0wMiIgc3R5bGU9InN0b3AtY29sb3I6IzAwOTVENSIvPgoJCTxzdG9wICBvZmZzZXQ9IjAuMzAwNyIgc3R5bGU9InN0b3AtY29sb3I6IzIzOEFEOSIvPgoJCTxzdG9wICBvZmZzZXQ9IjAuNjIxMSIgc3R5bGU9InN0b3AtY29sb3I6IzU1N0JERSIvPgoJCTxzdG9wICBvZmZzZXQ9IjAuODY0MyIgc3R5bGU9InN0b3AtY29sb3I6Izc0NzJFMiIvPgoJCTxzdG9wICBvZmZzZXQ9IjEiIHN0eWxlPSJzdG9wLWNvbG9yOiM4MDZFRTMiLz4KCTwvbGluZWFyR3JhZGllbnQ+Cgk8cG9seWdvbiBpZD0iWE1MSURfMl8iIHN0eWxlPSJmaWxsOnVybCgjWE1MSURfM18pOyIgcG9pbnRzPSIwLDYwIDMwLjEsMjkuOSA2MCw2MCAJIi8+CgoJCTxsaW5lYXJHcmFkaWVudCBpZD0iU1ZHSURfMV8iIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNC4yMDkyIiB5MT0iNDguOTQwOSIgeDI9IjIwLjY3MzQiIHkyPSI2NS40MDUiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoMSAwIDAgLTEgMCA2MSkiPgoJCTxzdG9wICBvZmZzZXQ9IjAuMTE4MyIgc3R5bGU9InN0b3AtY29sb3I6IzAwOTVENSIvPgoJCTxzdG9wICBvZmZzZXQ9IjAuNDE3OCIgc3R5bGU9InN0b3AtY29sb3I6IzNDODNEQyIvPgoJCTxzdG9wICBvZmZzZXQ9IjAuNjk2MiIgc3R5bGU9InN0b3AtY29sb3I6IzZENzRFMSIvPgoJCTxzdG9wICBvZmZzZXQ9IjAuODMzMyIgc3R5bGU9InN0b3AtY29sb3I6IzgwNkVFMyIvPgoJPC9saW5lYXJHcmFkaWVudD4KCTxwb2x5Z29uIHN0eWxlPSJmaWxsOnVybCgjU1ZHSURfMV8pOyIgcG9pbnRzPSIwLDAgMzAuMSwwIDAsMzIuNSAJIi8+CgoJCTxsaW5lYXJHcmFkaWVudCBpZD0iU1ZHSURfMl8iIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iLTEwLjEwMTciIHkxPSI1LjgzNjIiIHgyPSI0NS43MzE1IiB5Mj0iNjEuNjY5NCIgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCgxIDAgMCAtMSAwIDYxKSI+CgkJPHN0b3AgIG9mZnNldD0iMC4xMDc1IiBzdHlsZT0ic3RvcC1jb2xvcjojQzc1N0JDIi8+CgkJPHN0b3AgIG9mZnNldD0iMC4yMTM4IiBzdHlsZT0ic3RvcC1jb2xvcjojRDA2MDlBIi8+CgkJPHN0b3AgIG9mZnNldD0iMC40MjU0IiBzdHlsZT0ic3RvcC1jb2xvcjojRTE3MjVDIi8+CgkJPHN0b3AgIG9mZnNldD0iMC42MDQ4IiBzdHlsZT0ic3RvcC1jb2xvcjojRUU3RTJGIi8+CgkJPHN0b3AgIG9mZnNldD0iMC43NDMiIHN0eWxlPSJzdG9wLWNvbG9yOiNGNTg2MTMiLz4KCQk8c3RvcCAgb2Zmc2V0PSIwLjgyMzIiIHN0eWxlPSJzdG9wLWNvbG9yOiNGODg5MDkiLz4KCTwvbGluZWFyR3JhZGllbnQ+Cgk8cG9seWdvbiBzdHlsZT0iZmlsbDp1cmwoI1NWR0lEXzJfKTsiIHBvaW50cz0iMzAuMSwwIDAsMzEuNyAwLDYwIDMwLjEsMjkuOSA2MCwwIAkiLz4KPC9nPgo8L3N2Zz4K)
![ktor](https://img.shields.io/badge/ktor-v1.3.2-orange?style=flat&logo=data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA2MCA2MCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNjAgNjA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPGc+CgoJCTxsaW5lYXJHcmFkaWVudCBpZD0iWE1MSURfM18iIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iMTUuOTU5NCIgeTE9Ii0xMy4wMTQzIiB4Mj0iNDQuMzA2OCIgeTI9IjE1LjMzMzIiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoMSAwIDAgLTEgMCA2MSkiPgoJCTxzdG9wICBvZmZzZXQ9IjkuNjc3MDAwZS0wMiIgc3R5bGU9InN0b3AtY29sb3I6IzAwOTVENSIvPgoJCTxzdG9wICBvZmZzZXQ9IjAuMzAwNyIgc3R5bGU9InN0b3AtY29sb3I6IzIzOEFEOSIvPgoJCTxzdG9wICBvZmZzZXQ9IjAuNjIxMSIgc3R5bGU9InN0b3AtY29sb3I6IzU1N0JERSIvPgoJCTxzdG9wICBvZmZzZXQ9IjAuODY0MyIgc3R5bGU9InN0b3AtY29sb3I6Izc0NzJFMiIvPgoJCTxzdG9wICBvZmZzZXQ9IjEiIHN0eWxlPSJzdG9wLWNvbG9yOiM4MDZFRTMiLz4KCTwvbGluZWFyR3JhZGllbnQ+Cgk8cG9seWdvbiBpZD0iWE1MSURfMl8iIHN0eWxlPSJmaWxsOnVybCgjWE1MSURfM18pOyIgcG9pbnRzPSIwLDYwIDMwLjEsMjkuOSA2MCw2MCAJIi8+CgoJCTxsaW5lYXJHcmFkaWVudCBpZD0iU1ZHSURfMV8iIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNC4yMDkyIiB5MT0iNDguOTQwOSIgeDI9IjIwLjY3MzQiIHkyPSI2NS40MDUiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoMSAwIDAgLTEgMCA2MSkiPgoJCTxzdG9wICBvZmZzZXQ9IjAuMTE4MyIgc3R5bGU9InN0b3AtY29sb3I6IzAwOTVENSIvPgoJCTxzdG9wICBvZmZzZXQ9IjAuNDE3OCIgc3R5bGU9InN0b3AtY29sb3I6IzNDODNEQyIvPgoJCTxzdG9wICBvZmZzZXQ9IjAuNjk2MiIgc3R5bGU9InN0b3AtY29sb3I6IzZENzRFMSIvPgoJCTxzdG9wICBvZmZzZXQ9IjAuODMzMyIgc3R5bGU9InN0b3AtY29sb3I6IzgwNkVFMyIvPgoJPC9saW5lYXJHcmFkaWVudD4KCTxwb2x5Z29uIHN0eWxlPSJmaWxsOnVybCgjU1ZHSURfMV8pOyIgcG9pbnRzPSIwLDAgMzAuMSwwIDAsMzIuNSAJIi8+CgoJCTxsaW5lYXJHcmFkaWVudCBpZD0iU1ZHSURfMl8iIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iLTEwLjEwMTciIHkxPSI1LjgzNjIiIHgyPSI0NS43MzE1IiB5Mj0iNjEuNjY5NCIgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCgxIDAgMCAtMSAwIDYxKSI+CgkJPHN0b3AgIG9mZnNldD0iMC4xMDc1IiBzdHlsZT0ic3RvcC1jb2xvcjojQzc1N0JDIi8+CgkJPHN0b3AgIG9mZnNldD0iMC4yMTM4IiBzdHlsZT0ic3RvcC1jb2xvcjojRDA2MDlBIi8+CgkJPHN0b3AgIG9mZnNldD0iMC40MjU0IiBzdHlsZT0ic3RvcC1jb2xvcjojRTE3MjVDIi8+CgkJPHN0b3AgIG9mZnNldD0iMC42MDQ4IiBzdHlsZT0ic3RvcC1jb2xvcjojRUU3RTJGIi8+CgkJPHN0b3AgIG9mZnNldD0iMC43NDMiIHN0eWxlPSJzdG9wLWNvbG9yOiNGNTg2MTMiLz4KCQk8c3RvcCAgb2Zmc2V0PSIwLjgyMzIiIHN0eWxlPSJzdG9wLWNvbG9yOiNGODg5MDkiLz4KCTwvbGluZWFyR3JhZGllbnQ+Cgk8cG9seWdvbiBzdHlsZT0iZmlsbDp1cmwoI1NWR0lEXzJfKTsiIHBvaW50cz0iMzAuMSwwIDAsMzEuNyAwLDYwIDMwLjEsMjkuOSA2MCwwIAkiLz4KPC9nPgo8L3N2Zz4K)
![branch](https://img.shields.io/badge/branch-master-green.svg)

## Build

Building the project
```sh
./gradlew clean && ./gradlew build
```

Compiling the project and generating a docker image
```sh
./gradlew clean && ./gradlew build && docker build --no-cache -t crisun/ktor-koin-sample-app .
```

Compiling the project and generating a docker image with docker-compose
```sh
./gradlew clean && ./gradlew build && docker-compose build
```

## Start

Using docker-compose:
```sh
docker-compose up
```

Using docker:
```sh
docker run --rm -it -p 8080:8080 crisun/ktor-koin-sample-app
```

Running manually:
```sh
java -jar ktor-koin-sample-app-1.0.0-all.jar
```

## Examples

Start the application and call the operations:

Login to obtain jwt token:
```sh
curl -i -XPOST -H "Content-type: application/json" "http://localhost:8080/user/login" -d '{"username":"crisun","password":"r4e3w2q1"}'
```
List all tasks:
```sh
curl -i -H "Authorization: Bearer $TOKEN" "http://localhost:8080/todos"
```
Query a task:
```sh
curl -i -H "Authorization: Bearer $TOKEN" "http://localhost:8080/todo/1"
```
Insert task:
```sh
curl -i -XPOST -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" "http://localhost:8080/todo" -d '{"title":"Task 1","description":"Do the homework"}'
```
Update task:
```sh
curl -i -XPUT -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" "http://localhost:8080/todo/1" -d '{"title":"Task 1","description":"Do the homework and clean the house"}'
```
Delete task:
```sh
curl -i -XDELETE -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" "http://localhost:8080/todo/1"
```
Health check:
```sh
curl -i "http://localhost:8080/health"
```

## Libraries
Koin: https://insert-koin.io

Flywaydb: https://flywaydb.org

Logback: http://logback.qos.ch

Spring Jdbc: https://spring.io

H2 Database: https://www.h2database.com

HikariCP: https://github.com/brettwooldridge/HikariCP

Kotlin Logging: https://github.com/MicroUtils/kotlin-logging

Ktor flyway feature: https://github.com/viartemev/ktor-flyway-feature

Ktor JWT feature: https://ktor.io/servers/features/authentication/jwt.html

